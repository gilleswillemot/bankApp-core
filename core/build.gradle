apply plugin: 'com.android.library'
apply plugin: 'kotlin-multiplatform'


repositories {
    mavenCentral()
}

group = 'com.github.jitpack'
version = '1.0'

android {
    compileSdkVersion 28
    defaultConfig {
        minSdkVersion 21
        targetSdkVersion 28
        versionCode 1
        versionName "1.0"
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    lintOptions {
        abortOnError false
    }
//    sourceSets {
//        main.java.srcDirs += 'src/main/kotlin'
//        androidTest.java.srcDirs += 'src/androidTest/kotlin'
//        androidTest.resources.srcDirs += 'src/androidTest/res'
//    }
}

// kotlin multiplatform has a predefined template structure with a commonMain, thus
// references to your source are needed if deviating from this convention.
// This project was created with Android Studio: /src/main/java, while when using IDEA a multiplatform project would
// look like: /src/commonMain/kotlin
kotlin {
//    jvm("jar") // commented because error when compiling in jitpack: > A POM cannot have multiple artifacts
//    with the same type and classifier. Already have MavenArtifact core:jar:jar:null, trying to add
//    MavenArtifact core:jar:jar:null.
//    js("js") // Used name "js" to not have the jitpack error (cannot have multiple artifacts with same type and classifier),
//    This is probably because we need to use js("othername") as using js() will make core.jar (which already exists)

    // https://kotlinlang.org/docs/reference/building-mpp-with-gradle.html#android-support
    android {
        publishLibraryVariants("release", "debug")
    }

    sourceSets {
        main.kotlin.srcDirs += 'src/main/java'

        commonMain {
            // We add the source set origin, otherwise the files in src/main/java would not be compiled.
            dependsOn main
            kotlin.srcDir('src')
        }
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])

    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"
}

task sourcesJar(type: Jar) {
    classifier = 'sources'
    from android.sourceSets.main.java.sourceFiles
}

task javadoc(type: Javadoc) {
    source = android.sourceSets.main.java.sourceFiles
    classpath += project.files(android.getBootClasspath().join(File.pathSeparator))
}

task javadocJar(type: Jar, dependsOn: javadoc) {
    classifier = 'javadoc'
    from javadoc.destinationDir
}

task classesJar(type: Jar) {
    from "$buildDir/intermediates/classes/release"
}

artifacts {
    archives classesJar
    archives javadocJar
    archives sourcesJar
}